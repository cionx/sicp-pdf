\usepackage{microtype}

\usepackage{xstring}

\usepackage[automark]{scrlayer-scrpage}

% Font settings
\RequirePackage[
	% no space around the following equal sign!
	warnings-off={mathtools-colon,mathtools-overbracket},
	partial = upright
]{unicode-math}

\defaultfontfeatures{%
	Scale=MatchLowercase, % needed here ...
}
\setmonofont{JuliaMono}

\defaultfontfeatures{%
	Scale=MatchLowercase, % ... and here again
	Mapping=tex-text,
	SmallCapsFeatures={LetterSpace=2.5,WordSpace=1.05},
}
\setmainfont[
	Numbers = OldStyle
]{Libertinus Serif}
\setsansfont{Libertinus Sans}
\setmathfont{Libertinus Math}

\usepackage{polyglossia}
\setdefaultlanguage[variant=american]{english}
\setotherlanguages{greek}

% To be able to use '\-/' in place of '-' inside \code{}
% so that long function names containing hyphens
% can be broken up after the hyphen:
\usepackage[shortcuts]{extdash}

% So that file names with multiple dots donâ€™t confuse
% graphicx package when using \includegraphics command:
\usepackage[multidot]{grffile}
\usepackage{graphicx}

\usepackage[usenames,dvipsnames,x11names]{xcolor}
\usepackage{mathtools}

\usepackage{svg}
\svgsetup{
	inkscapelatex = false
}

\usepackage{minted}

\usepackage{fancyvrb}
\usepackage{imakeidx}
\usepackage[totoc,font=footnotesize]{idxlayout}
\usepackage[final]{pdfpages} % inserts pages from a pdf file
\usepackage[use-files = {true}]{xsim} % to typeset exercises
\usepackage{booktabs}
\usepackage{enumitem}  % allows customized labels in enumerations
\usepackage{hyperref}  % makes cross references and URLs clickable

% remove numbers from headmark
\renewcommand*{\chaptermarkformat}{\thechapter.\enspace}
\renewcommand*{\sectionmarkformat}{\thesection.\enspace}
% pagenumber in bold
%\addtokomafont{pagenumber}{\bfseries}
% even pages header
\lehead{\pagemark}
\rehead{\upshape{\headmark}}
% odd pages header
\rohead{\pagemark}
\lohead{\upshape{\headmark}}
% make foot empty
\ofoot{}
\cfoot{}
\ifoot{}


\xsimsetup{
	path = {exercises},
	exercise/within = {chapter},
	exercise/the-counter = {\thechapter.\arabic{exercise}}
}

\definecolor{LinkRed}{HTML}{80171F}
\hypersetup{
	pdfauthor  = {Harold Abelson, Gerald Jay Sussman, Julie Sussman},
	pdftitle   = {Structure and Interpretation of Computer Programs, 2nd ed.},
	pdfsubject = {computer science, programming, abstraction},
	colorlinks = true,
	linkcolor  = LinkRed,
	urlcolor   = LinkRed,
}

% Quotes at the beginning of chapters
\renewcommand{\dictumwidth}{0.7\linewidth}
\renewcommand{\dictumrule}{\vspace{0.5em}}
\renewcommand{\dictumauthorformat}[1]{#1}
\renewcommand{\raggeddictumauthor}{\raggedright}
\addtokomafont{dictumtext}{\rmfamily}
\addtokomafont{dictumauthor}{\upshape}

% Document colors
\definecolor{DropCapViolet}{HTML}{9090C0}

\usemintedstyle{default}
\newminted[scheme]{scheme}{autogobble, escapeinside=~~}
\newminted[smallscheme]{scheme}{autogobble, escapeinside=~~}
\newminted[example]{text}{}
\newminted[smallexample]{text}{}
% some of the colors included in the style
% extracted with a color picker
\definecolor{DefaultVariable}{HTML}{19177D}

\usepackage{lettrine}  % adds commands that make drop capitals
\renewcommand{\LettrineFontHook}{\rmfamily\mdseries\color{DropCapViolet}}
\renewcommand{\DefaultLraise}{0.00}
\renewcommand{\DefaultLoversize}{0.02}
\renewcommand{\DefaultLhang}{0.12}
\setlength{\DefaultFindent}{1pt}
\setlength{\DefaultNindent}{0em}


\newcommand{\acronym}[1]{\textsc{\fontspec[Numbers={OldStyle}]{Libertinus Serif}\MakeLowercase{#1}}}
\newcommand{\booktitle}{\emph}
\newcommand{\dollar}[1]{\$#1}
\newcommand{\heading}[1]{{\sffamily\bfseries #1}}
\newcommand{\link}[1]{\hyperref[#1]{#1}}
\newcommand{\mono}[1]{\hbox{\ttfamily\scriptsize #1}}
\newcommand{\monoit}[1]{\hbox{\ttfamily\itshape\scriptsize #1}}
\newcommand{\newterm}[1]{\index{#1}\emph{#1}}
\newcommand{\nth}[1]{#1}
\newcommand{\outprint}{\textsl}
\newcommand{\uppersc}[1]{{\fontspec[Letters=UppercaseSmallCaps]{Libertinus Serif}#1}}

\newcommand{\code}{\texttt}
\newcommand{\dark}[1]{#1}
\newcommand{\var}[1]{\textsl{\texttt{#1}}}
\newcommand{\cvar}{\color{DefaultVariable}\var}
\newcommand{\ind}[1]{\textsubscript{\ttfamily \indint{#1}}}
\newcommand{\indint}[1]{\IfInteger{#1}{\textup{#1}}{#1}}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

\frenchspacing
\makeindex

\setlist[description, 1]{
	leftmargin = *,
	labelsep = 0pt
}

\DeclareMathOperator{\Angle}{Angle}
\DeclareMathOperator{\Imagpart}{Imaginary-part}
\DeclareMathOperator{\Magnitude}{Magnitude}
\DeclareMathOperator{\Fib}{Fib}
\DeclareMathOperator{\Realpart}{Real-part}

\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
